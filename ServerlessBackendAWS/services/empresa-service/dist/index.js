!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=4)}([function(e,t,r){"use strict";var n=r(1),i=t.ValidationError=function(e,t,r,n,i,s){n&&(this.property=n),e&&(this.message=e),r&&(r.id?this.schema=r.id:this.schema=r),t&&(this.instance=t),this.name=i,this.argument=s,this.stack=this.toString()};i.prototype.toString=function(){return this.property+" "+this.message};var s=t.ValidatorResult=function(e,t,r,n){this.instance=e,this.schema=t,this.propertyPath=n.propertyPath,this.errors=[],this.throwError=r&&r.throwError,this.disableFormat=r&&!0===r.disableFormat};function a(e,t){return t+": "+e.toString()+"\n"}s.prototype.addError=function(e){var t;if("string"==typeof e)t=new i(e,this.instance,this.schema,this.propertyPath);else{if(!e)throw new Error("Missing error detail");if(!e.message)throw new Error("Missing error message");if(!e.name)throw new Error("Missing validator type");t=new i(e.message,this.instance,this.schema,this.propertyPath,e.name,e.argument)}if(this.throwError)throw t;return this.errors.push(t),t},s.prototype.importErrors=function(e){"string"==typeof e||e&&e.validatorType?this.addError(e):e&&e.errors&&Array.prototype.push.apply(this.errors,e.errors)},s.prototype.toString=function(e){return this.errors.map(a).join("")},Object.defineProperty(s.prototype,"valid",{get:function(){return!this.errors.length}});var o=t.SchemaError=function e(t,r){this.message=t,this.schema=r,Error.call(this,t),Error.captureStackTrace(this,e)};o.prototype=Object.create(Error.prototype,{constructor:{value:o,enumerable:!1},name:{value:"SchemaError",enumerable:!1}});var u=t.SchemaContext=function(e,t,r,n,i){this.schema=e,this.options=t,this.propertyPath=r,this.base=n,this.schemas=i};u.prototype.resolve=function(e){return n.resolve(this.base,e)},u.prototype.makeChild=function(e,t){var r=void 0===t?this.propertyPath:this.propertyPath+d(t),i=n.resolve(this.base,e.id||""),s=new u(e,this.options,r,i,Object.create(this.schemas));return e.id&&!s.schemas[i]&&(s.schemas[i]=e),s};var c=t.FORMAT_REGEXPS={"date-time":/^\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])[tT ](2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])(\.\d+)?([zZ]|[+-]([0-5][0-9]):(60|[0-5][0-9]))$/,date:/^\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])$/,time:/^(2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])$/,email:/^(?:[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+\.)*[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!\.)){0,61}[a-zA-Z0-9]?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\[(?:(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\.){3}(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\]))$/,"ip-address":/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,ipv6:/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,uri:/^[a-zA-Z][a-zA-Z0-9+-.]*:[^\s]*$/,color:/^(#?([0-9A-Fa-f]{3}){1,2}\b|aqua|black|blue|fuchsia|gray|green|lime|maroon|navy|olive|orange|purple|red|silver|teal|white|yellow|(rgb\(\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*\))|(rgb\(\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*\)))$/,hostname:/^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\.?$/,"host-name":/^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\.?$/,alpha:/^[a-zA-Z]+$/,alphanumeric:/^[a-zA-Z0-9]+$/,"utc-millisec":function(e){return"string"==typeof e&&parseFloat(e)===parseInt(e,10)&&!isNaN(e)},regex:function(e){var t=!0;try{new RegExp(e)}catch(e){t=!1}return t},style:/\s*(.+?):\s*([^;]+);?/g,phone:/^\+(?:[0-9] ?){6,14}[0-9]$/};c.regexp=c.regex,c.pattern=c.regex,c.ipv4=c["ip-address"],t.isFormat=function(e,t,r){if("string"==typeof e&&void 0!==c[t]){if(c[t]instanceof RegExp)return c[t].test(e);if("function"==typeof c[t])return c[t](e)}else if(r&&r.customFormats&&"function"==typeof r.customFormats[t])return r.customFormats[t](e);return!0};var d=t.makeSuffix=function(e){return(e=e.toString()).match(/[.\s\[\]]/)||e.match(/^[\d]/)?e.match(/^\d+$/)?"["+e+"]":"["+JSON.stringify(e)+"]":"."+e};function m(e,t){var r=Array.isArray(t),n=r&&[]||{};return r?(e=e||[],n=n.concat(e),t.forEach(function(e,t,r,n){"object"==typeof r?t[n]=m(e[n],r):-1===e.indexOf(r)&&t.push(r)}.bind(null,e,n))):(e&&"object"==typeof e&&Object.keys(e).forEach(function(e,t,r){t[r]=e[r]}.bind(null,e,n)),Object.keys(t).forEach(function(e,t,r,n){"object"==typeof t[n]&&t[n]&&e[n]?r[n]=m(e[n],t[n]):r[n]=t[n]}.bind(null,e,t,n))),n}function l(e){return"/"+encodeURIComponent(e).replace(/~/g,"%7E")}t.deepCompareStrict=function e(t,r){if(typeof t!=typeof r)return!1;if(t instanceof Array)return r instanceof Array&&(t.length===r.length&&t.every(function(n,i){return e(t[i],r[i])}));if("object"==typeof t){if(!t||!r)return t===r;var n=Object.keys(t),i=Object.keys(r);return n.length===i.length&&n.every(function(n){return e(t[n],r[n])})}return t===r},e.exports.deepMerge=m,t.objectGetPath=function(e,t){for(var r,n=t.split("/").slice(1);"string"==typeof(r=n.shift());){var i=decodeURIComponent(r.replace(/~0/,"~").replace(/~1/g,"/"));if(!(i in e))return;e=e[i]}return e},t.encodePath=function(e){return e.map(l).join("")},t.getDecimalPlaces=function(e){var t=0;if(isNaN(e))return t;"number"!=typeof e&&(e=Number(e));var r=e.toString().split("e");if(2===r.length){if("-"!==r[1][0])return t;t=Number(r[1].slice(1))}var n=r[0].split(".");return 2===n.length&&(t+=n[1].length),t}},function(e,t){e.exports=require("url")},function(e,t,r){var n=r(1),i=r(0);function s(e,t){this.id=e,this.ref=t}e.exports.SchemaScanResult=s,e.exports.scan=function(e,t){function r(e,t){if(t&&"object"==typeof t)if(t.$ref){var s=n.resolve(e,t.$ref);c[s]=c[s]?c[s]+1:0}else{var d=t.id?n.resolve(e,t.id):e;if(d){if(d.indexOf("#")<0&&(d+="#"),u[d]){if(!i.deepCompareStrict(u[d],t))throw new Error("Schema <"+t+"> already exists with different definition");return u[d]}u[d]=t,"#"==d[d.length-1]&&(u[d.substring(0,d.length-1)]=t)}a(d+"/items",t.items instanceof Array?t.items:[t.items]),a(d+"/extends",t.extends instanceof Array?t.extends:[t.extends]),r(d+"/additionalItems",t.additionalItems),o(d+"/properties",t.properties),r(d+"/additionalProperties",t.additionalProperties),o(d+"/definitions",t.definitions),o(d+"/patternProperties",t.patternProperties),o(d+"/dependencies",t.dependencies),a(d+"/disallow",t.disallow),a(d+"/allOf",t.allOf),a(d+"/anyOf",t.anyOf),a(d+"/oneOf",t.oneOf),r(d+"/not",t.not)}}function a(e,t){if(t instanceof Array)for(var n=0;n<t.length;n++)r(e+"/"+n,t[n])}function o(e,t){if(t&&"object"==typeof t)for(var n in t)r(e+"/"+n,t[n])}var u={},c={};return r(e,t),new s(u,c)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HttpStatusCode={ok:200,created:201,badRequest:400,forbidden:403,notFound:404,internalServerError:500};class n{static ok(e){return n.parseResponse(e,t.HttpStatusCode.ok)}static created(e,r){return n.parseResponse(r,t.HttpStatusCode.created)}static badRequest(e,r){const i=n.parseError(t.HttpStatusCode.badRequest,e,r);return n.parseResponse(i,t.HttpStatusCode.badRequest)}static forbidden(e,r){const i=n.parseError(t.HttpStatusCode.forbidden,"REDACTED",r);return n.parseResponse(i,t.HttpStatusCode.forbidden)}static notFound(e,r){const i=n.parseError(t.HttpStatusCode.notFound,e,r);return n.parseResponse(i,t.HttpStatusCode.notFound)}static internalError(e,r){const i=n.parseError(t.HttpStatusCode.internalServerError,"REDACTED",r);return n.parseResponse(i,t.HttpStatusCode.internalServerError)}static parseError(e,t,r){return{error:{statusCode:e,message:t+(r?":TraceId -> ${traceId}":"")}}}static parseResponse(e,t){return{statusCode:t,headers:{},body:e?JSON.stringify(e):null}}}t.ResponseBuilder=n},function(e,t,r){e.exports=r(5)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3),i=r(6),s=r(8),a=r(9),o=r(11),u="thisBucket",c="thisTable",d="thisTopic",m=!!process.env.LAMBDA_TASK_ROOT;var l;t.injetResolver=function(e){l=e},t.handler=function(e,t,r){const p=a(),f={topicArn:d,body:JSON.stringify(e)},h=m?new i.AWSProxyResolver:l;if(null==h){const e=t.awsRequestId,i="Function not Configured: Resource Dispatcher not Found! TraceId:${traceId}";!function(e){console.error("Publishing Error in Contigence!"),console.error(e)}(i);const s=n.ResponseBuilder.internalError(i,e);return void r(null,s)}const y=new s.Sidecar(h,t);o.Validators.isValidAPIGatewayEvent(e).then(t=>y.userIsAuthorizedToPerformOperation(e)).then(e=>(function(e){return new Promise((e,t)=>{e(JSON.stringify({key:"value"}))})})()).then(t=>Promise.all([y.persistInTable(c,p,t),y.persistOnLake(u,p,e)])).then(t=>y.publishEvent(f,e)).then(t=>y.createResponse(e)).then(e=>y.sendResponse(e,r)).catch(e=>{const t=y.createErrorResponse(e);y.sendResponse(t,r)})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(7);t.AWSProxyResolver=class{constructor(){this.topicsCache=[],this.bucketCache=[],this.metricCache=[],this.tablesCache=[]}topic(e){const t=this.topicsCache.filter(e=>{e.key});return t.length>0?t[0].object:new i(e)}bucket(e,t){const r=this.bucketCache.filter(e=>{e.key});return r.length>0?r[0].object:new s(e,t)}metric(e,t){const r=this.metricCache.filter(e=>{e.key});return r.length>0?r[0].object:new a(e,t)}table(e,t){const r=this.tablesCache.filter(e=>{e.key});return r.length>0?r[0].object:new o(e,t)}};class i{constructor(e){this.arn=e,this.Errors={invalidArn:"invalidConfiguration"}}publish(e){return new Promise((t,r)=>{const i=this.validateArnAndReturnRegion(e.TopicArn);i||r({code:this.Errors.invalidArn,resource:this.arn});const s=new n.SNS({region:i}),a={Message:JSON.stringify(e),TopicArn:this.arn};s.publish(a,(e,n)=>{e?r(u.parseAWSError(e)):t(n.MessageId)})})}validateArnAndReturnRegion(e){let t=e.split(":");if(!(t.length<7))return t[3]}}t.AWSTopic=i;class s{constructor(e,t){this.region=e,this.name=t}getObject(e){return new Promise((e,t)=>{e(null)})}putObject(e,t){return new Promise((e,t)=>{e(!0)})}}t.AWSBucket=s;class a{constructor(e,t){this.region=e,this.name=t}publish(e,t){return new Promise((e,t)=>{e(!0)})}}t.AWSMetric=a;class o{constructor(e,t){this.region=e,this.name=t}marshalObject(e){return n.DynamoDB.Converter.marshall(e,{convertEmptyValues:!0,wrapNumbers:!0})}unmarshalObject(e){return n.DynamoDB.Converter.unmarshall(e,{convertEmptyValues:!0,wrapNumbers:!0})}putItem(e){return new Promise((t,r)=>{n.DynamoDB.Converter.input(e,{convertEmptyValues:!0,wrapNumbers:!0}),n.DynamoDB.Converter.marshall(e,{convertEmptyValues:!0,wrapNumbers:!0});t(!0)})}deleteItem(e){return new Promise((e,t)=>{e(!0)})}}t.AWSTable=o;class u{static parseAWSError(e){return{code:"invalid",resource:"",payload:""}}}},function(e,t){e.exports=aws-sdk},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3);var i;!function(e){e[e.userNotAuthorized=0]="userNotAuthorized",e[e.invalidObjectBody=1]="invalidObjectBody",e[e.resourceNotAvailable=2]="resourceNotAvailable",e[e.dependencyError=3]="dependencyError",e[e.dependencyErrorSns=4]="dependencyErrorSns",e[e.configurationNotAvailable=5]="configurationNotAvailable",e[e.invalidConfiguration=6]="invalidConfiguration",e[e[void 0]=7]="undefined"}(i||(i={}));t.Sidecar=class{constructor(e,t){this.dependencyResolver=e,this.lambdaContext=t,this.trail=[]}userIsAuthorizedToPerformOperation(e){const t=(new a).withAction("userIsAuthorizedToPerformOperation");return new Promise((e,r)=>{if(this.matchPermissions())this.trail.push(t.build()),e(!0);else{const e={error:i.userNotAuthorized};this.trail.push(t.withError(e).build()),r(n.ResponseBuilder.forbidden("Auth Failed!",this.lambdaContext.awsRequestId))}})}persistOnLake(e,t,r){const n={bucketName:e,eventId:t},i=(new a).withAction("persistOnLake").withPayload(r.body).withParameters(n);return new Promise((e,t)=>{this.trail.push(i.build()),e(!0)})}persistInTable(e,t,r){const n={tableName:e,key:t},i=(new a).withAction("persistInTable").withPayload(r).withParameters(n);return new Promise((e,t)=>{this.trail.push(i.build()),e(!0)})}publishEvent(e,t){const r=(new a).withAction("publishEvent");return new Promise((e,t)=>{this.trail.push(r.build()),e(!0)})}publishMetric(e){return new Promise((e,t)=>{e(!0)})}createResponse(e){return{statusCode:200,body:JSON.stringify(e)}}createErrorResponse(e){return{statusCode:200,body:JSON.stringify(e)}}publishError(e,t){return new Promise((t,r)=>{t(e)})}sendResponse(e,t){this.publishOperationTrail(),t(null,e)}matchPermissions(){return!0}createMetricFromError(e){return{metricArn:"",value:{value:1}}}publishOperationTrail(){}publishErrorInContingence(e){console.error("Publishing Error in Contigence!"),console.error(e)}};class s{constructor(e){this.timestamp=e.timestamp,this.durationInMillis=e.durationInMillis,this.action=e.action,this.success=e.success,this.parameters=e.parameters,this.payload=e.payload,this.error=e.error}}t.SidecarOperation=s;class a{constructor(){this.timestamp=new Date}withAction(e){return this.action=e,this}withParameters(e){return this.parameters=e,this}withPayload(e){return this.payload=e,this}withError(e){return this.error=e,this}build(){const e=new Date;return this.durationInMillis=e.getTime()-this.timestamp.getTime(),null===this.error||void 0===this.error?this.success=!0:this.success=!1,new s(this)}}},function(e,t,r){var n=r(10);for(var i=[],s=0;s<256;++s)i[s]=(s+256).toString(16).substr(1);var a=function(e,t,r){var s=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||function(){return n.randomBytes(16)})();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var o=0;o<16;++o)t[s+o]=a[o];return t||function(e,t){var r=t||0,n=i;return[n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]]].join("")}(a)};e.exports=a},function(e,t){e.exports=require("crypto")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(12);t.Validators=class{static isValidEmail(e){return new Promise((e,t)=>{e(!0)})}static isValidUUID(e){return new Promise((e,t)=>{e(!0)})}static isValidAPIGatewayEvent(e){return new Promise((e,t)=>{e(!0)})}static isValidSNSEvent(e){return new Promise((e,t)=>{e(!0)})}static isValidSQSEvent(e){return new Promise((e,t)=>{e(!0)})}static isValidS3Event(e){return new Promise((e,t)=>{e(!0)})}static isValidDynamoEvent(e){return new Promise((e,t)=>{e(!0)})}static isValidKinesisEvent(e){return new Promise((e,t)=>{e(!0)})}static isValidTopicArn(e){return new Promise((e,t)=>{e(!0)})}static isValidObject(e,t){return(new n.Validator).validate(t,e).valid}}},function(e,t,r){"use strict";var n=e.exports.Validator=r(13);e.exports.ValidatorResult=r(0).ValidatorResult,e.exports.ValidationError=r(0).ValidationError,e.exports.SchemaError=r(0).SchemaError,e.exports.SchemaScanResult=r(2).SchemaScanResult,e.exports.scan=r(2).scan,e.exports.validate=function(e,t,r){return(new n).validate(e,t,r)}},function(e,t,r){"use strict";var n=r(1),i=r(14),s=r(0),a=r(2).scan,o=s.ValidatorResult,u=s.SchemaError,c=s.SchemaContext,d=function e(){this.customFormats=Object.create(e.prototype.customFormats),this.schemas={},this.unresolvedRefs=[],this.types=Object.create(l),this.attributes=Object.create(i.validators)};function m(e){var t="string"==typeof e?e:e.$ref;return"string"==typeof t&&t}d.prototype.customFormats={},d.prototype.schemas=null,d.prototype.types=null,d.prototype.attributes=null,d.prototype.unresolvedRefs=null,d.prototype.addSchema=function(e,t){var r=this;if(!e)return null;var n=a(t||"/",e),i=t||e.id;for(var s in n.id)this.schemas[s]=n.id[s];for(var s in n.ref)this.unresolvedRefs.push(s);return this.unresolvedRefs=this.unresolvedRefs.filter(function(e){return void 0===r.schemas[e]}),this.schemas[i]},d.prototype.addSubSchemaArray=function(e,t){if(t instanceof Array)for(var r=0;r<t.length;r++)this.addSubSchema(e,t[r])},d.prototype.addSubSchemaObject=function(e,t){if(t&&"object"==typeof t)for(var r in t)this.addSubSchema(e,t[r])},d.prototype.setSchemas=function(e){this.schemas=e},d.prototype.getSchema=function(e){return this.schemas[e]},d.prototype.validate=function(e,t,r,i){r||(r={});var s=r.propertyName||"instance",o=n.resolve(r.base||"/",t.id||"");if(!i){(i=new c(t,r,s,o,Object.create(this.schemas))).schemas[o]||(i.schemas[o]=t);var d=a(o,t);for(var m in d.id){var l=d.id[m];i.schemas[m]=l}}if(t){var p=this.validateSchema(e,t,r,i);if(!p)throw new Error("Result undefined");return p}throw new u("no schema specified",t)},d.prototype.validateSchema=function(e,t,r,n){var a,d=new o(e,t,r,n);if("boolean"==typeof t)!0===t?t={}:!1===t&&(t={type:[]});else if(!t)throw new Error("schema is undefined");if(t.extends)if(t.extends instanceof Array){var l={schema:t,ctx:n};t.extends.forEach(this.schemaTraverser.bind(this,l)),t=l.schema,l.schema=null,l.ctx=null,l=null}else t=s.deepMerge(t,this.superResolve(t.extends,n));if(a=m(t)){var p=this.resolve(t,a,n),f=new c(p.subschema,r,n.propertyPath,p.switchSchema,n.schemas);return this.validateSchema(e,p.subschema,r,f)}var h=r&&r.skipAttributes||[];for(var y in t)if(!i.ignoreProperties[y]&&h.indexOf(y)<0){var v=null,g=this.attributes[y];if(g)v=g.call(this,e,t,r,n);else if(!1===r.allowUnknownAttributes)throw new u("Unsupported attribute: "+y,t);v&&d.importErrors(v)}if("function"==typeof r.rewrite){var b=r.rewrite.call(this,e,t,r,n);d.instance=b}return d},d.prototype.schemaTraverser=function(e,t){e.schema=s.deepMerge(e.schema,this.superResolve(t,e.ctx))},d.prototype.superResolve=function(e,t){var r;return(r=m(e))?this.resolve(e,r,t).subschema:e},d.prototype.resolve=function(e,t,r){if(t=r.resolve(t),r.schemas[t])return{subschema:r.schemas[t],switchSchema:t};var i=n.parse(t),a=i&&i.hash,o=a&&a.length&&t.substr(0,t.length-a.length);if(!o||!r.schemas[o])throw new u("no such schema <"+t+">",e);var c=s.objectGetPath(r.schemas[o],a.substr(1));if(void 0===c)throw new u("no such schema "+a+" located in <"+o+">",e);return{subschema:c,switchSchema:t}},d.prototype.testType=function(e,t,r,n,i){if("function"==typeof this.types[i])return this.types[i].call(this,e);if(i&&"object"==typeof i){var s=this.validateSchema(e,i,r,n);return void 0===s||!(s&&s.errors.length)}return!0};var l=d.prototype.types={};l.string=function(e){return"string"==typeof e},l.number=function(e){return"number"==typeof e&&isFinite(e)},l.integer=function(e){return"number"==typeof e&&e%1==0},l.boolean=function(e){return"boolean"==typeof e},l.array=function(e){return Array.isArray(e)},l.null=function(e){return null===e},l.date=function(e){return e instanceof Date},l.any=function(e){return!0},l.object=function(e){return e&&"object"==typeof e&&!(e instanceof Array)&&!(e instanceof Date)},e.exports=d},function(e,t,r){"use strict";var n=r(0),i=n.ValidatorResult,s=n.SchemaError,a={ignoreProperties:{id:!0,default:!0,description:!0,title:!0,exclusiveMinimum:!0,exclusiveMaximum:!0,additionalItems:!0,$schema:!0,$ref:!0,extends:!0}},o=a.validators={};function u(e,t,r,n,i){var s=t.throwError;t.throwError=!1;var a=this.validateSchema(e,i,t,r);return t.throwError=s,!a.valid&&n instanceof Function&&n(a),a.valid}function c(e,t,r,n,i,s){if(this.types.object(e)&&(!t.properties||void 0===t.properties[i]))if(!1===t.additionalProperties)s.addError({name:"additionalProperties",argument:i,message:"additionalProperty "+JSON.stringify(i)+" exists in instance when not allowed"});else{var a=t.additionalProperties||{};"function"==typeof r.preValidateProperty&&r.preValidateProperty(e,i,a,r,n);var o=this.validateSchema(e[i],a,r,n.makeChild(a,i));o.instance!==s.instance[i]&&(s.instance[i]=o.instance),s.importErrors(o)}}o.type=function(e,t,r,n){if(void 0===e)return null;var s=new i(e,t,r,n),a=Array.isArray(t.type)?t.type:[t.type];if(!a.some(this.testType.bind(this,e,t,r,n))){var o=a.map(function(e){return e.id&&"<"+e.id+">"||e+""});s.addError({name:"type",argument:o,message:"is not of a type(s) "+o})}return s},o.anyOf=function(e,t,r,n){if(void 0===e)return null;var a=new i(e,t,r,n),o=new i(e,t,r,n);if(!Array.isArray(t.anyOf))throw new s("anyOf must be an array");if(!t.anyOf.some(u.bind(this,e,r,n,function(e){o.importErrors(e)}))){var c=t.anyOf.map(function(e,t){return e.id&&"<"+e.id+">"||e.title&&JSON.stringify(e.title)||e.$ref&&"<"+e.$ref+">"||"[subschema "+t+"]"});r.nestedErrors&&a.importErrors(o),a.addError({name:"anyOf",argument:c,message:"is not any of "+c.join(",")})}return a},o.allOf=function(e,t,r,n){if(void 0===e)return null;if(!Array.isArray(t.allOf))throw new s("allOf must be an array");var a=new i(e,t,r,n),o=this;return t.allOf.forEach(function(t,i){var s=o.validateSchema(e,t,r,n);if(!s.valid){var u=t.id&&"<"+t.id+">"||t.title&&JSON.stringify(t.title)||t.$ref&&"<"+t.$ref+">"||"[subschema "+i+"]";a.addError({name:"allOf",argument:{id:u,length:s.errors.length,valid:s},message:"does not match allOf schema "+u+" with "+s.errors.length+" error[s]:"}),a.importErrors(s)}}),a},o.oneOf=function(e,t,r,n){if(void 0===e)return null;if(!Array.isArray(t.oneOf))throw new s("oneOf must be an array");var a=new i(e,t,r,n),o=new i(e,t,r,n),c=t.oneOf.filter(u.bind(this,e,r,n,function(e){o.importErrors(e)})).length,d=t.oneOf.map(function(e,t){return e.id&&"<"+e.id+">"||e.title&&JSON.stringify(e.title)||e.$ref&&"<"+e.$ref+">"||"[subschema "+t+"]"});return 1!==c&&(r.nestedErrors&&a.importErrors(o),a.addError({name:"oneOf",argument:d,message:"is not exactly one from "+d.join(",")})),a},o.properties=function(e,t,r,n){if(this.types.object(e)){var s=new i(e,t,r,n),a=t.properties||{};for(var o in a){"function"==typeof r.preValidateProperty&&r.preValidateProperty(e,o,a[o],r,n);var u=Object.hasOwnProperty.call(e,o)?e[o]:void 0,c=this.validateSchema(u,a[o],r,n.makeChild(a[o],o));c.instance!==s.instance[o]&&(s.instance[o]=c.instance),s.importErrors(c)}return s}},o.patternProperties=function(e,t,r,n){if(this.types.object(e)){var s=new i(e,t,r,n),a=t.patternProperties||{};for(var o in e){var u=!0;for(var d in a){if(new RegExp(d).test(o)){u=!1,"function"==typeof r.preValidateProperty&&r.preValidateProperty(e,o,a[d],r,n);var m=this.validateSchema(e[o],a[d],r,n.makeChild(a[d],o));m.instance!==s.instance[o]&&(s.instance[o]=m.instance),s.importErrors(m)}}u&&c.call(this,e,t,r,n,o,s)}return s}},o.additionalProperties=function(e,t,r,n){if(this.types.object(e)){if(t.patternProperties)return null;var s=new i(e,t,r,n);for(var a in e)c.call(this,e,t,r,n,a,s);return s}},o.minProperties=function(e,t,r,n){if(this.types.object(e)){var s=new i(e,t,r,n);return Object.keys(e).length>=t.minProperties||s.addError({name:"minProperties",argument:t.minProperties,message:"does not meet minimum property length of "+t.minProperties}),s}},o.maxProperties=function(e,t,r,n){if(this.types.object(e)){var s=new i(e,t,r,n);return Object.keys(e).length<=t.maxProperties||s.addError({name:"maxProperties",argument:t.maxProperties,message:"does not meet maximum property length of "+t.maxProperties}),s}},o.items=function(e,t,r,n){var s=this;if(this.types.array(e)&&t.items){var a=new i(e,t,r,n);return e.every(function(e,i){var o=Array.isArray(t.items)?t.items[i]||t.additionalItems:t.items;if(void 0===o)return!0;if(!1===o)return a.addError({name:"items",message:"additionalItems not permitted"}),!1;var u=s.validateSchema(e,o,r,n.makeChild(o,i));return u.instance!==a.instance[i]&&(a.instance[i]=u.instance),a.importErrors(u),!0}),a}},o.minimum=function(e,t,r,n){if(this.types.number(e)){var s=new i(e,t,r,n);return(t.exclusiveMinimum&&!0===t.exclusiveMinimum?e>t.minimum:e>=t.minimum)||s.addError({name:"minimum",argument:t.minimum,message:"must have a minimum value of "+t.minimum}),s}},o.maximum=function(e,t,r,n){if(this.types.number(e)){var s=new i(e,t,r,n);return(t.exclusiveMaximum&&!0===t.exclusiveMaximum?e<t.maximum:e<=t.maximum)||s.addError({name:"maximum",argument:t.maximum,message:"must have a maximum value of "+t.maximum}),s}};var d=function(e,t,r,a,o,u){if(this.types.number(e)){var c=t[o];if(0==c)throw new s(o+" cannot be zero");var d=new i(e,t,r,a),m=n.getDecimalPlaces(e),l=n.getDecimalPlaces(c),p=Math.max(m,l),f=Math.pow(10,p);return Math.round(e*f)%Math.round(c*f)!=0&&d.addError({name:o,argument:c,message:u+JSON.stringify(c)}),d}};function m(e,t,r){var i,s=r.length;for(i=t+1;i<s;i++)if(n.deepCompareStrict(e,r[i]))return!1;return!0}o.multipleOf=function(e,t,r,n){return d.call(this,e,t,r,n,"multipleOf","is not a multiple of (divisible by) ")},o.divisibleBy=function(e,t,r,n){return d.call(this,e,t,r,n,"divisibleBy","is not divisible by (multiple of) ")},o.required=function(e,t,r,n){var s=new i(e,t,r,n);return void 0===e&&!0===t.required?s.addError({name:"required",message:"is required"}):this.types.object(e)&&Array.isArray(t.required)&&t.required.forEach(function(t){void 0===e[t]&&s.addError({name:"required",argument:t,message:"requires property "+JSON.stringify(t)})}),s},o.pattern=function(e,t,r,n){if(this.types.string(e)){var s=new i(e,t,r,n);return e.match(t.pattern)||s.addError({name:"pattern",argument:t.pattern,message:"does not match pattern "+JSON.stringify(t.pattern)}),s}},o.format=function(e,t,r,s){if(void 0!==e){var a=new i(e,t,r,s);return a.disableFormat||n.isFormat(e,t.format,this)||a.addError({name:"format",argument:t.format,message:"does not conform to the "+JSON.stringify(t.format)+" format"}),a}},o.minLength=function(e,t,r,n){if(this.types.string(e)){var s=new i(e,t,r,n),a=e.match(/[\uDC00-\uDFFF]/g);return e.length-(a?a.length:0)>=t.minLength||s.addError({name:"minLength",argument:t.minLength,message:"does not meet minimum length of "+t.minLength}),s}},o.maxLength=function(e,t,r,n){if(this.types.string(e)){var s=new i(e,t,r,n),a=e.match(/[\uDC00-\uDFFF]/g);return e.length-(a?a.length:0)<=t.maxLength||s.addError({name:"maxLength",argument:t.maxLength,message:"does not meet maximum length of "+t.maxLength}),s}},o.minItems=function(e,t,r,n){if(this.types.array(e)){var s=new i(e,t,r,n);return e.length>=t.minItems||s.addError({name:"minItems",argument:t.minItems,message:"does not meet minimum length of "+t.minItems}),s}},o.maxItems=function(e,t,r,n){if(this.types.array(e)){var s=new i(e,t,r,n);return e.length<=t.maxItems||s.addError({name:"maxItems",argument:t.maxItems,message:"does not meet maximum length of "+t.maxItems}),s}},o.uniqueItems=function(e,t,r,s){if(this.types.array(e)){var a=new i(e,t,r,s);return e.every(function(e,t,r){for(var i=t+1;i<r.length;i++)if(n.deepCompareStrict(e,r[i]))return!1;return!0})||a.addError({name:"uniqueItems",message:"contains duplicate item"}),a}},o.uniqueItems=function(e,t,r,n){if(this.types.array(e)){var s=new i(e,t,r,n);return e.every(m)||s.addError({name:"uniqueItems",message:"contains duplicate item"}),s}},o.dependencies=function(e,t,r,n){if(this.types.object(e)){var s=new i(e,t,r,n);for(var a in t.dependencies)if(void 0!==e[a]){var o=t.dependencies[a],u=n.makeChild(o,a);if("string"==typeof o&&(o=[o]),Array.isArray(o))o.forEach(function(t){void 0===e[t]&&s.addError({name:"dependencies",argument:u.propertyPath,message:"property "+t+" not found, required by "+u.propertyPath})});else{var c=this.validateSchema(e,o,r,u);s.instance!==c.instance&&(s.instance=c.instance),c&&c.errors.length&&(s.addError({name:"dependencies",argument:u.propertyPath,message:"does not meet dependency required by "+u.propertyPath}),s.importErrors(c))}}return s}},o.enum=function(e,t,r,a){if(void 0===e)return null;if(!Array.isArray(t.enum))throw new s("enum expects an array",t);var o=new i(e,t,r,a);return t.enum.some(n.deepCompareStrict.bind(null,e))||o.addError({name:"enum",argument:t.enum,message:"is not one of enum values: "+t.enum.map(String).join(",")}),o},o.const=function(e,t,r,s){if(void 0===e)return null;var a=new i(e,t,r,s);return n.deepCompareStrict(t.const,e)||a.addError({name:"const",argument:t.const,message:"does not exactly match expected constant: "+t.const}),a},o.not=o.disallow=function(e,t,r,n){var s=this;if(void 0===e)return null;var a=new i(e,t,r,n),o=t.not||t.disallow;return o?(Array.isArray(o)||(o=[o]),o.forEach(function(i){if(s.testType(e,t,r,n,i)){var o=i&&i.id&&"<"+i.id+">"||i;a.addError({name:"not",argument:o,message:"is of prohibited type "+o})}}),a):null},e.exports=a}]);